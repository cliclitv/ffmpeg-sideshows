import{r as R,o as G,c as N,F as le,a as ge,b as k,t as K,d as me,w as ve,v as we,e as ne}from"./index.29cbbd11.js";var ye="https://cliclitv.github.io/ffmpeg-sideshows/delete.858524c4.png";const be={class:"file"},_e=["src"],xe=["onClick"],Fe={class:"file-li",title:"\u4E0A\u4F20(PNG)\u56FE\u7247"},Le=k("p",{class:"file-li-text"},"\u4E0A\u4F20(PNG)\u56FE\u7247",-1),Ee={class:"file-li",title:"\u4E0A\u4F20\u80CC\u666F\u97F3\u4E50"},ke={class:"file-li-text"},$e={__name:"UploadFile",emits:["change"],setup(o,{emit:c}){const a=R([]),n=R({}),f=u=>{let y=u.target.files;l(y,0)},l=(u,y)=>{let d=new FileReader;d.readAsDataURL(u[y]),d.onload=$=>{a.value.push(Object.assign($,{raw:u[y]})),++y<u.length&&l(u,y),c("change",{imgs:a.value,videoBg:n.value})}},g=u=>{n.value=u.target.files[0],c("change",{imgs:a.value,videoBg:n.value})},p=u=>{a.value.splice(u,1),c("change",{imgs:a.value,videoBg:n.value})};return(u,y)=>(G(),N("ul",be,[(G(!0),N(le,null,ge(a.value,(d,$)=>(G(),N("li",{class:"file-li",key:$},[k("img",{class:"file-li-main",src:d.target.result,alt:""},null,8,_e),k("img",{class:"file-li-delete",src:ye,alt:"",onClick:T=>p($),title:"\u5220\u9664\u56FE\u7247"},null,8,xe)]))),128)),k("li",Fe,[Le,k("input",{class:"file-li-file",type:"file",accept:"image/png",multiple:"",onChange:f},null,32)]),k("li",Ee,[k("p",ke,K(n.value.name?n.value.name:"\u4E0A\u4F20\u80CC\u666F\u97F3\u4E50"),1),k("input",{class:"file-li-file",type:"file",accept:"audio/*",onChange:g},null,32)])]))}};var je=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Se={exports:{}};(function(o){var c=function(a){var n=Object.prototype,f=n.hasOwnProperty,l,g=typeof Symbol=="function"?Symbol:{},p=g.iterator||"@@iterator",u=g.asyncIterator||"@@asyncIterator",y=g.toStringTag||"@@toStringTag";function d(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch{d=function(e,r,s){return e[r]=s}}function $(t,e,r,s){var i=e&&e.prototype instanceof D?e:D,w=Object.create(i.prototype),x=new q(s||[]);return w._invoke=de(t,r,x),w}a.wrap=$;function T(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(s){return{type:"throw",arg:s}}}var b="suspendedStart",j="suspendedYield",C="executing",m="completed",E={};function D(){}function h(){}function v(){}var _={};d(_,p,function(){return this});var O=Object.getPrototypeOf,S=O&&O(O(Y([])));S&&S!==n&&f.call(S,p)&&(_=S);var U=v.prototype=D.prototype=Object.create(_);h.prototype=v,d(U,"constructor",v),d(v,"constructor",h),h.displayName=d(v,y,"GeneratorFunction");function te(t){["next","throw","return"].forEach(function(e){d(t,e,function(r){return this._invoke(e,r)})})}a.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===h||(e.displayName||e.name)==="GeneratorFunction":!1},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,d(t,y,"GeneratorFunction")),t.prototype=Object.create(U),t},a.awrap=function(t){return{__await:t}};function W(t,e){function r(w,x,F,P){var L=T(t[w],t,x);if(L.type==="throw")P(L.arg);else{var H=L.arg,I=H.value;return I&&typeof I=="object"&&f.call(I,"__await")?e.resolve(I.__await).then(function(A){r("next",A,F,P)},function(A){r("throw",A,F,P)}):e.resolve(I).then(function(A){H.value=A,F(H)},function(A){return r("throw",A,F,P)})}}var s;function i(w,x){function F(){return new e(function(P,L){r(w,x,P,L)})}return s=s?s.then(F,F):F()}this._invoke=i}te(W.prototype),d(W.prototype,u,function(){return this}),a.AsyncIterator=W,a.async=function(t,e,r,s,i){i===void 0&&(i=Promise);var w=new W($(t,e,r,s),i);return a.isGeneratorFunction(e)?w:w.next().then(function(x){return x.done?x.value:w.next()})};function de(t,e,r){var s=b;return function(w,x){if(s===C)throw new Error("Generator is already running");if(s===m){if(w==="throw")throw x;return oe()}for(r.method=w,r.arg=x;;){var F=r.delegate;if(F){var P=re(F,r);if(P){if(P===E)continue;return P}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(s===b)throw s=m,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);s=C;var L=T(t,e,r);if(L.type==="normal"){if(s=r.done?m:j,L.arg===E)continue;return{value:L.arg,done:r.done}}else L.type==="throw"&&(s=m,r.method="throw",r.arg=L.arg)}}}function re(t,e){var r=t.iterator[e.method];if(r===l){if(e.delegate=null,e.method==="throw"){if(t.iterator.return&&(e.method="return",e.arg=l,re(t,e),e.method==="throw"))return E;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return E}var s=T(r,t.iterator,e.arg);if(s.type==="throw")return e.method="throw",e.arg=s.arg,e.delegate=null,E;var i=s.arg;if(!i)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,E;if(i.done)e[t.resultName]=i.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=l);else return i;return e.delegate=null,E}te(U),d(U,y,"Generator"),d(U,p,function(){return this}),d(U,"toString",function(){return"[object Generator]"});function he(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function V(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function q(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(he,this),this.reset(!0)}a.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function s(){for(;e.length;){var i=e.pop();if(i in t)return s.value=i,s.done=!1,s}return s.done=!0,s}};function Y(t){if(t){var e=t[p];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var r=-1,s=function i(){for(;++r<t.length;)if(f.call(t,r))return i.value=t[r],i.done=!1,i;return i.value=l,i.done=!0,i};return s.next=s}}return{next:oe}}a.values=Y;function oe(){return{value:l,done:!0}}return q.prototype={constructor:q,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(V),!t)for(var e in this)e.charAt(0)==="t"&&f.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(P,L){return w.type="throw",w.arg=t,e.next=P,L&&(e.method="next",e.arg=l),!!L}for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s],w=i.completion;if(i.tryLoc==="root")return r("end");if(i.tryLoc<=this.prev){var x=f.call(i,"catchLoc"),F=f.call(i,"finallyLoc");if(x&&F){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(x){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else if(F){if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&f.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var i=s;break}}i&&(t==="break"||t==="continue")&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var w=i?i.completion:{};return w.type=t,w.arg=e,i?(this.method="next",this.next=i.finallyLoc,E):this.complete(w)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),E},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),V(r),E}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var s=r.completion;if(s.type==="throw"){var i=s.arg;V(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:Y(t),resultName:e,nextLoc:r},this.method==="next"&&(this.arg=l),E}},a}(o.exports);try{regeneratorRuntime=c}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=c:Function("r","regeneratorRuntime = r")(c)}})(Se);var Pe={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}};let Q=!1,ce=()=>{};const Ce=o=>{Q=o},Oe=o=>{ce=o},Te=(o,c)=>{ce({type:o,message:c}),Q&&console.log(`[${o}] ${c}`)};var fe={logging:Q,setLogging:Ce,setCustomLogger:Oe,log:Te};let M=0,J=0;const ie=o=>{const[c,a,n]=o.split(":");return parseFloat(c)*60*60+parseFloat(a)*60+parseFloat(n)};var Ue=(o,c)=>{if(typeof o=="string")if(o.startsWith("  Duration")){const a=o.split(", ")[0].split(": ")[1],n=ie(a);c({duration:n,ratio:J}),(M===0||M>n)&&(M=n)}else if(o.startsWith("frame")||o.startsWith("size")){const a=o.split("time=")[1].split(" ")[0],n=ie(a);J=n/M,c({ratio:J,time:n})}else o.startsWith("video:")&&(c({ratio:1}),M=0)},Re=(o,c)=>{const a=o._malloc(c.length*Uint32Array.BYTES_PER_ELEMENT);return c.forEach((n,f)=>{const l=o._malloc(n.length+1);o.writeAsciiToMemory(n,l),o.setValue(a+Uint32Array.BYTES_PER_ELEMENT*f,l,"i32")}),[c.length,a]},ee={exports:{}};(function(o,c){(function(a,n){o.exports=n()})(je,function(){function a(){var n=arguments.length;if(n===0)throw new Error("resolveUrl requires at least one argument; got none.");var f=document.createElement("base");if(f.href=arguments[0],n===1)return f.href;var l=document.getElementsByTagName("head")[0];l.insertBefore(f,l.firstChild);for(var g=document.createElement("a"),p,u=1;u<n;u++)g.href=arguments[u],p=g.href,f.href=p;return l.removeChild(f),p}return a})})(ee);const Ae="@ffmpeg/ffmpeg",Be="0.10.1",Ge="FFmpeg WebAssembly version",Ne="src/index.js",De="src/index.d.ts",Ie={example:"examples"},Me={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},ze={"./src/node/index.js":"./src/browser/index.js"},We={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},Ve=["ffmpeg","WebAssembly","video"],qe="Jerome Wu <jeromewus@gmail.com>",Ye="MIT",He={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},Je={node:">=12.16.1"},Xe="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Ze={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},Ke={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.10.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"};var ue={name:Ae,version:Be,description:Ge,main:Ne,types:De,directories:Ie,scripts:Me,browser:ze,repository:We,keywords:Ve,author:qe,license:Ye,bugs:He,engines:Je,homepage:Xe,dependencies:Ze,devDependencies:Ke};const{devDependencies:Qe}=ue;var et={corePath:`https://unpkg.com/@ffmpeg/core@${Qe["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`};const tt=ee.exports,{log:z}=fe,X=async(o,c)=>{z("info",`fetch ${o}`);const a=await(await fetch(o)).arrayBuffer();z("info",`${o} file size = ${a.byteLength} bytes`);const n=new Blob([a],{type:c}),f=URL.createObjectURL(n);return z("info",`${o} blob URL = ${f}`),f};var rt=async({corePath:o})=>{if(typeof o!="string")throw Error("corePath should be a string!");const c=tt(o),a=await X(c,"application/javascript"),n=await X(c.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),f=await X(c.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore=="undefined"?new Promise(l=>{const g=document.createElement("script"),p=()=>{g.removeEventListener("load",p),z("info","ffmpeg-core.js script loaded"),l({createFFmpegCore,corePath:a,wasmPath:n,workerPath:f})};g.src=a,g.type="text/javascript",g.addEventListener("load",p),document.getElementsByTagName("head")[0].appendChild(g)}):(z("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:a,wasmPath:n,workerPath:f}))};const ot=ee.exports,nt=o=>new Promise((c,a)=>{const n=new FileReader;n.onload=()=>{c(n.result)},n.onerror=({target:{error:{code:f}}})=>{a(Error(`File could not be read! Code=${f}`))},n.readAsArrayBuffer(o)});var it=async o=>{let c=o;return typeof o=="undefined"?new Uint8Array:(typeof o=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(o)?c=atob(o.split(",")[1]).split("").map(a=>a.charCodeAt(0)):c=await(await fetch(ot(o))).arrayBuffer():(o instanceof File||o instanceof Blob)&&(c=await nt(o)),new Uint8Array(c))};const at=et,st=rt,lt=it;var pe={defaultOptions:at,getCreateFFmpegCore:st,fetchFile:lt};const{defaultArgs:ct,baseOptions:ft}=Pe,{setLogging:ae,setCustomLogger:se,log:B}=fe,ut=Ue,pt=Re,{defaultOptions:dt,getCreateFFmpegCore:ht}=pe,{version:gt}=ue,Z=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var mt=(o={})=>{const{log:c,logger:a,progress:n,...f}={...ft,...dt,...o};let l=null,g=null,p=null,u=!1,y=n;const d=h=>{h==="FFMPEG_END"&&p!==null&&(p(),p=null,u=!1)},$=({type:h,message:v})=>{B(h,v),ut(v,y),d(v)},T=async()=>{if(B("info","load ffmpeg-core"),l===null){B("info","loading ffmpeg-core");const{createFFmpegCore:h,corePath:v,workerPath:_,wasmPath:O}=await ht(f);l=await h({mainScriptUrlOrBlob:v,printErr:S=>$({type:"fferr",message:S}),print:S=>$({type:"ffout",message:S}),locateFile:(S,U)=>{if(typeof window!="undefined"){if(typeof O!="undefined"&&S.endsWith("ffmpeg-core.wasm"))return O;if(typeof _!="undefined"&&S.endsWith("ffmpeg-core.worker.js"))return _}return U+S}}),g=l.cwrap("proxy_main","number",["number","number"]),B("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},b=()=>l!==null,j=(...h)=>{if(B("info",`run ffmpeg command: ${h.join(" ")}`),l===null)throw Z;if(u)throw Error("ffmpeg.wasm can only run one command at a time");return u=!0,new Promise(v=>{const _=[...ct,...h].filter(O=>O.length!==0);p=v,g(...pt(l,_))})},C=(h,...v)=>{if(B("info",`run FS.${h} ${v.map(_=>typeof _=="string"?_:`<${_.length} bytes binary file>`).join(" ")}`),l===null)throw Z;{let _=null;try{_=l.FS[h](...v)}catch{throw Error(h==="readdir"?`ffmpeg.FS('readdir', '${v[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:h==="readFile"?`ffmpeg.FS('readFile', '${v[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return _}},m=()=>{if(l===null)throw Z;u=!1,l.exit(1),l=null,g=null,p=null},E=h=>{y=h},D=h=>{se(h)};return ae(c),se(a),B("info",`use ffmpeg.wasm v${gt}`),{setProgress:E,setLogger:D,setLogging:ae,load:T,isLoaded:b,run:j,exit:m,FS:C}};const vt=mt,{fetchFile:wt}=pe;var yt={createFFmpeg:vt,fetchFile:wt};const bt={class:"container"},_t={class:"form"},xt=["disabled"],Ft={key:0,class:"text"},Lt=["src"],kt={__name:"index",setup(o){const{createFFmpeg:c,fetchFile:a}=yt,n=c({log:!1}),f=R([]),l=R({}),g=b=>{f.value=b.imgs,l.value=b.videoBg},p=R(""),u=R(""),y=R(!0),d=R(""),$=async()=>{n.isLoaded()||await n.load();for(let m in f.value)n.FS("writeFile",`${m}.png`,await a(f.value[m].raw));n.setProgress(({ratio:m})=>{y.value=m==1}),n.setLogger(m=>{u.value=m.message});const b=d.value.toString()||"1",j=(f.value.length*b).toString();if(l.value.name){const m=encodeURI(l.value.name);n.FS("writeFile",m,await a(l.value)),await n.run("-r",b,"-f","image2","-i","%d.png","-i",m,"-t",j,"video.mp4")}else await n.run("-r",b,"-f","image2","-i","%d.png","-t",j,"video.mp4");const C=n.FS("readFile","video.mp4");p.value=URL.createObjectURL(new Blob([C.buffer],{type:"video/mp4"}))},T=()=>{const b=new XMLHttpRequest;b.open("GET",p.value),b.responseType="blob",b.onload=j=>{if(j.target.status==200){const C=window.URL.createObjectURL(j.currentTarget.response),m=document.createElement("a");m.href=C,m.setAttribute("download",`${new Date().getTime()}.mp4`),m.click()}},b.send()};return(b,j)=>(G(),N("div",bt,[me($e,{onChange:g}),k("div",_t,[k("button",{onClick:$,class:"form-btn",disabled:!(f.value.length>0)},K(f.value.length>0?"\u5408\u6210\u89C6\u9891":"\u261D\uFE0F\u8BF7\u4E0A\u4F20(PNG)\u56FE\u7247"),9,xt),ve(k("input",{class:"form-input","onUpdate:modelValue":j[0]||(j[0]=C=>d.value=C),type:"number",placeholder:"\u8BBE\u7F6E\u5E27\u6570(\u9ED8\u8BA41)"},null,512),[[we,d.value]])]),u.value?(G(),N("p",Ft,K(y.value?"\u5408\u6210\u89C6\u9891\u5B8C\u6210":u.value),1)):ne("",!0),p.value?(G(),N(le,{key:1},[k("video",{class:"main",src:p.value,controls:""},null,8,Lt),k("button",{class:"download",onClick:T},"\u4E0B\u8F7D\u89C6\u9891")],64)):ne("",!0)]))}};export{kt as default};
